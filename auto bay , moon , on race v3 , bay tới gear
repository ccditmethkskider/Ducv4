-- H√†m Tween ƒë·ªÉ di chuy·ªÉn m∆∞·ª£t
function topos(Pos)
    local player = game.Players.LocalPlayer
    local char = player.Character
    local hrp = char and char:FindFirstChild("HumanoidRootPart")
    local humanoid = char and char:FindFirstChildOfClass("Humanoid")

    if not hrp or not humanoid then return end
    if humanoid.Sit then humanoid.Sit = false end

    local distance = (Pos.Position - hrp.Position).Magnitude
    local speed = 200 -- ƒêi·ªÅu ch·ªânh t·ªëc ƒë·ªô bay
    local duration = distance / speed
    local startTime = tick()

    -- Di chuy·ªÉn m∆∞·ª£t theo th·ªùi gian
    while tick() - startTime < duration do
        if _G.StopTween then break end
        local alpha = (tick() - startTime) / duration
        hrp.CFrame = hrp.CFrame:Lerp(Pos, alpha)
        task.wait()
    end

    -- ƒê·∫∑t v·ªã tr√≠ cu·ªëi c√πng ch√≠nh x√°c
    if not _G.StopTween then
        hrp.CFrame = Pos
    end
end

-- B·∫≠t h·ªá th·ªëng bay ƒë·∫øn ƒë·∫£o
_G.MysticIsland = true
spawn(function()
    while wait() do
        if _G.MysticIsland then
            local mysticIsland = game:GetService("Workspace").Map:FindFirstChild("MysticIsland")
            if mysticIsland then
                local position = mysticIsland.WorldPivot.Position
                topos(CFrame.new(position.X, position.Y + 500, position.Z)) -- Bay cao h∆°n ƒë·ªÉ tr√°nh r∆°i
                _G.MysticIsland = false -- D·ª´ng bay sau khi ƒë·∫øn n∆°i

                -- Sau khi ƒë·∫øn ƒë·∫£o, b·∫Øt ƒë·∫ßu nh√¨n trƒÉng v√† b·∫≠t t·ªôc V3
                _G.AutoLockMoon = true
            end
        end
    end
end)

-- T·ª± ƒë·ªông nh√¨n l√™n trƒÉng
spawn(function()
    while wait() do
        pcall(function()
            if _G.AutoLockMoon then
                local moonDir = game.Lighting:GetMoonDirection()
                local lookAtPos = game.Workspace.CurrentCamera.CFrame.p + moonDir * 100
                game.Workspace.CurrentCamera.CFrame = CFrame.lookAt(game.Workspace.CurrentCamera.CFrame.p, lookAtPos)
            end
        end)
    end
end)

-- B·∫≠t ph√≠m T ƒë·ªÉ k√≠ch ho·∫°t t·ªôc V3
spawn(function()
    while wait() do
        pcall(function()
            if _G.AutoLockMoon then
                game:GetService("VirtualInputManager"):SendKeyEvent(true, "T", false, game)
                wait(0.1)
                game:GetService("VirtualInputManager"):SendKeyEvent(false, "T", false, game)
                print("üü¢ ƒê√£ k√≠ch ho·∫°t t·ªôc V3!")

                -- ƒê·ª£i 5 gi√¢y tr∆∞·ªõc khi bay ƒë·∫øn b√°nh rƒÉng
                wait(5)
                _G.AutoLockMoon = false -- D·ª´ng nh√¨n trƒÉng
                _G.TweenMGear = true -- B·∫Øt ƒë·∫ßu bay ƒë·∫øn b√°nh rƒÉng
            end
        end)
    end
end)

-- Bay ƒë·∫øn b√°nh rƒÉng tr√™n ƒë·∫£o
_G.TweenMGear = false
spawn(function()
    while wait() do
        if _G.TweenMGear then
            if game:GetService("Workspace").Map:FindFirstChild("MysticIsland") then
                for i, v in pairs(game:GetService("Workspace").Map.MysticIsland:GetChildren()) do
                    if v:IsA("MeshPart") and v.Material == Enum.Material.Neon then
                        print("üü¢ ƒê√£ t√¨m th·∫•y b√°nh rƒÉng! ƒêang bay ƒë·∫øn...")
                        topos(v.CFrame)
                        _G.TweenMGear = false -- D·ª´ng bay sau khi ƒë·∫øn n∆°i
                    end
                end
            end
        end
    end
end)
