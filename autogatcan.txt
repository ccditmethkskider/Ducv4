getgenv().Config = {
    ["Select Join"] = "Pirates", -- Pirates ho·∫∑c Marines
    ["Webhook Url"] = "", -- ƒêi·ªÅn Webhook c·ªßa b·∫°n v√†o ƒë√¢y
    ["Auto Random Fruit"] = true, -- false
    ["DevilFruitESP"] = true, -- Hi·ªán ESP tr√°i
}

local HttpService = game:GetService("HttpService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local TeleportService = game:GetService("TeleportService")
local LocalPlayer = Players.LocalPlayer

-- H√†m g·ª≠i Webhook
function PostWebhook(message)
    local request = http_request or request or HttpPost or syn.request
    if Config["Webhook Url"] ~= "" then
        request({
            Url = Config["Webhook Url"],
            Method = "POST",
            Headers = {["Content-Type"] = "application/json"},
            Body = HttpService:JSONEncode(message)
        })
    end
end

-- Webhook khi nh·∫∑t ƒë∆∞·ª£c tr√°i
function WebhookFruitCollected(fruitName)
    local embed = {
        ["embeds"] = {{
            ["title"] = "**ƒê√£ Nh·∫∑t ƒê∆∞·ª£c Tr√°i C√¢y!**",
            ["color"] = math.random(0, 0xFFFFFF),
            ["fields"] = {
                {["name"] = "üë§ Ng∆∞·ªùi ch∆°i", ["value"] = LocalPlayer.Name, ["inline"] = true},
                {["name"] = "üçè Tr√°i c√¢y", ["value"] = fruitName, ["inline"] = true},
                {["name"] = "üåç Server ID", ["value"] = game.JobId, ["inline"] = false},
            },
            ["timestamp"] = os.date("!%Y-%m-%dT%H:%M:%S"),
        }}
    }
    PostWebhook(embed)
end

-- Webhook khi random ƒë∆∞·ª£c tr√°i c√¢y
function WebhookRandomFruit(fruitName)
    local embed = {
        ["embeds"] = {{
            ["title"] = "**ƒê√£ Mua Tr√°i Random!**",
            ["color"] = math.random(0, 0xFFFFFF),
            ["fields"] = {
                {["name"] = "üë§ Ng∆∞·ªùi ch∆°i", ["value"] = LocalPlayer.Name, ["inline"] = true},
                {["name"] = "üçè Tr√°i c√¢y", ["value"] = fruitName, ["inline"] = true},
                {["name"] = "üåç Server ID", ["value"] = game.JobId, ["inline"] = false},
            },
            ["timestamp"] = os.date("!%Y-%m-%dT%H:%M:%S"),
        }}
    }
    PostWebhook(embed)
end

-- Auto v√†o team khi v√†o game
spawn(function()
    repeat wait() until game:IsLoaded()
    local selectedTeam = Config["Select Join"]
    
    if selectedTeam == "Pirates" or selectedTeam == "Marines" then
        ReplicatedStorage.Remotes.CommF_:InvokeServer("SetTeam", selectedTeam)
        wait(1)
        TeleportService:Teleport(game.PlaceId, LocalPlayer)
    end
end)

-- Auto random fruit n·∫øu b·∫≠t
spawn(function()
    while wait(0.1) do
        pcall(function()
            if Config["Auto Random Fruit"] then
                local result = ReplicatedStorage.Remotes.CommF_:InvokeServer("Cousin", "Buy")
                if result then
                    WebhookRandomFruit(result)
                end
            end
        end)
    end
end)

-- Hi·ªán ESP tr√°i c√¢y r∆°i
local function UpdateDevilChams()
    for _, v in pairs(game.Workspace:GetChildren()) do
        pcall(function()
            if Config["DevilFruitESP"] and string.find(v.Name, "Fruit") and v:FindFirstChild("Handle") then
                if not v.Handle:FindFirstChild("NameEsp") then
                    local bill = Instance.new("BillboardGui", v.Handle)
                    bill.Name = "NameEsp"
                    bill.Size = UDim2.new(1, 200, 1, 30)
                    bill.Adornee = v.Handle
                    bill.AlwaysOnTop = true
                    
                    local name = Instance.new("TextLabel", bill)
                    name.Font = Enum.Font.GothamSemibold
                    name.TextSize = 14
                    name.Size = UDim2.new(1, 0, 1, 0)
                    name.BackgroundTransparency = 1
                    name.TextColor3 = Color3.new(1, 0, 0)
                    name.Text = "üçè Tr√°i C√¢y"
                end
            end
        end)
    end
end

spawn(function()
    while wait(1) do
        UpdateDevilChams()
    end
end)

-- Auto nh·∫∑t tr√°i c√¢y
spawn(function()
    while wait(1) do
        for _, fruit in pairs(workspace:GetChildren()) do
            if fruit.Name:find("Fruit") and fruit:IsA("Tool") then
                game.StarterGui:SetCore("SendNotification", {Title = "Zush Hub", Text = "ƒêang nh·∫∑t tr√°i...", Duration = 5})
                
                local char = LocalPlayer.Character
                local root = char and char:FindFirstChild("HumanoidRootPart")
                
                if root then
                    root.CFrame = fruit.Handle.CFrame
                    wait(1)
                    
                    local collectedFruit = fruit.Name
                    WebhookFruitCollected(collectedFruit)
                    
                    -- C·∫•t tr√°i v√†o kho
                    wait(1)
                    ReplicatedStorage.Remotes.CommF_:InvokeServer("StoreFruit", collectedFruit, fruit)
                end
            end
        end
    end
end)

-- Auto ƒë·ªïi server n·∫øu kh√¥ng c√≥ tr√°i ho·∫∑c ƒë√£ nh·∫∑t xong
spawn(function()
    while wait(10) do
        local hasFruit = false
        for _, fruit in pairs(workspace:GetChildren()) do
            if fruit.Name:find("Fruit") and fruit:IsA("Tool") then
                hasFruit = true
                break
            end
        end

        if not hasFruit then
            game.StarterGui:SetCore("SendNotification", {Title = "Zush Hub", Text = "Kh√¥ng c√≥ tr√°i! ƒê·ªïi server...", Duration = 5})

            local placeId = game.PlaceId
            local servers = HttpService:JSONDecode(game:HttpGet("https://games.roblox.com/v1/games/" .. placeId .. "/servers/Public?sortOrder=Asc&limit=100"))

            for _, server in pairs(servers.data) do
                if server.playing < server.maxPlayers then
                    TeleportService:TeleportToPlaceInstance(placeId, server.id, LocalPlayer)
                    break
                end
            end
        end
    end
end)
